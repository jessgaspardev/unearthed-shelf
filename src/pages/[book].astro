---
import Layout from "../layouts/Layout.astro";


// components
import Head from "../components/global/Head.astro";
import Breadcrumbs from "../components/elements/Breadcrumbs.astro";
import Categories from "../components/elements/Categories.astro";
import Heading from "../components/elements/Heading.astro";
import Text from "../components/elements/Text.astro";
import Link from "../components/elements/Link.astro";

// assets
import { Image } from "astro:assets";

// routing
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
export const getStaticPaths = ( async () => {
    const books = await getCollection('books');
    return books.map((book) => ({
        params: {
            book: book.data.slug
        },
        props: {
            book
        }
    }))
    
}) satisfies GetStaticPaths;

// props
const { book } = Astro.props;
const { title, author, genre, year, rating, description, cover, goodreads, bookshop } = book.data

const breadcrumbItems = [
  { label: 'Home', href: '/' },
  { label: genre, href: `/${genre.toLowerCase().replace(/\s+/g, '-')}` },
  { label: title } // Current page - no href
];

---

<Head 
  pageTitle={title}
  description={`${title} by ${author} (${year}) - ${description.substring(0, 155)}...`}
  ogImage={cover.src}
/>

<Layout>
    <Categories />
    <Breadcrumbs items={breadcrumbItems} />
    <section class="flex md:flex-row flex-col gap-8 p-8">
        <div class="lg:flex-2 flex-1 flex flex-col gap-4">
            <Heading tagName="h1" tagSize="h3">{title}</Heading>
            <div>
                <Text variant={'md'}>Author: <span class="text-primary">{author}</span></Text>
                <Text variant={'md'}>Year: <span class="text-primary">{year}</span></Text>
                <Text variant={'md'}>Genre: <span class="text-primary">{genre}</span></Text>
                <Text variant={'md'}>Rating: <span class="text-primary">{rating}</span> ‚≠ê</Text>
            </div>
            <Text variant={'sm'}>{description}</Text>
            <div class="flex sm:flex-row flex-col gap-4">
                <Link variant={'buttonSecondary'} href={goodreads} newWindow>Goodreads</Link>
            </div>

        </div>
        <div class="flex-1">
            <Image
                src={cover}
                alt={title}
                loading="eager"
                class="w-full h-full object-cover"
            ></Image>
        </div>
    </section>
</Layout>

<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "Book",
  "name": title,
  "author": {
    "@type": "Person",
    "name": author
  },
  "datePublished": year,
  "genre": genre,
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": rating,
    "bestRating": "5",
    "worstRating": "1"
  },
  "image": new URL(cover.src, Astro.site).href,
  "url": Astro.url.href
})} />